name: Build & Push Frontend (Angular) to Docker Hub
on:
 push:
   branches: [ main ]
   paths:
     - "src/**"
     - "package.json"
     - "package-lock.json"
     - "angular.json"
     - "Dockerfile"
     - ".github/workflows/deployment.yml"
 workflow_dispatch:
env:
 IMAGE_NAME: ${{ secrets.DOCKERHUB_USERNAME }}/frontend
 NODE_VERSION: "18"
jobs:
 build-and-push:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout
       uses: actions/checkout@v4
     - name: Use Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
         cache: 'npm'
     - name: Install deps (ci)
       run: npm ci
     - name: Build Angular
       # If your Angular project name is different, change APP_NAME below or set a repo secret APP_NAME
       env:
         APP_NAME: ${{ secrets.ANGULAR_APP_NAME || 'angular-app' }}
       run: |
         npx ng version || npm i -D @angular/cli
         npx ng build --configuration production
       
         ls -la "dist/${APP_NAME}"
     - name: Set up Docker Buildx
       uses: docker/setup-buildx-action@v3
     - name: Log in to Docker Hub
       uses: docker/login-action@v3
       with:
         username: ${{ secrets.DOCKERHUB_USERNAME }}
         password: ${{ secrets.DOCKERHUB_TOKEN }}
     - name: Build and push
       uses: docker/build-push-action@v6
       with:
         context: .
         push: true
         tags: |
           ${{ env.IMAGE_NAME }}:latest
           ${{ env.IMAGE_NAME }}:${{ github.sha }}
         build-args: |
           APP_NAME=${{ secrets.ANGULAR_APP_NAME || 'angular-app' }}
